<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-145799979-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    
    gtag('config', 'UA-145799979-1');
  </script>
  <!-- Include pre-loads to reduce/optimize page load time-->
  <link rel="preload" href="https://shortcutIV.com/includes/baseSiteStyling.css" as="style">
  <link rel="preload" href="https://shortcutIV.com/includes/httpsRedirect.js" as="script">
  <link rel="preload" href="https://shortcutIV.com/includes/escapedFooter.js" as="script">
  <link rel="preload" href="https://shortcutIV.com/includes/sortingHat.js" as="script">
  <link rel="preload" href="https://shortcutIV.com/includes/awesomplete.base.css" as="style">
  <link rel="preload" href="https://shortcutIV.com/includes/awesomplete.min.js" as="script">
  <link rel="preload" href="https://shortcutIV.com/includes/pokeList.js" as="script">
  <title>ShortcutIV - PvP Search Strings</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Pok&eacute;mon Go&trade; PvP search string generator to find your best (or trash the rest). By copy+pasting these strings into PoGo, you can quicky figure out what to power up and what to send to Professor Willow!"/>
  <script async src="https://shortcutIV.com/includes/httpsRedirect.js"></script>
  <!-- Includes for FavIcon support-->
  <link rel="apple-touch-icon" sizes="57x57" href="/favIcon/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/favIcon/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/favIcon/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/favIcon/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/favIcon/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/favIcon/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/favIcon/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/favIcon/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/favIcon/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="/favIcon/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favIcon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/favIcon/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favIcon/favicon-16x16.png">
  <link rel="manifest" href="/favIcon/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <!-- End Includes for favIcon support-->
  <link rel="stylesheet" href="https://shortcutIV.com/includes/baseSiteStyling.css">
  <link rel="stylesheet" href="https://shortcutIV.com/includes/awesomplete.base.css">
  <script src="https://www.google.com/recaptcha/api.js?render=6LfY-KYUAAAAAIYnP89WU5GWU-MMg_uy0z_7t9c2"></script>
</head>
<body onload="checkURI()">
  <header>
    <ul class="header">
      <li class="dropdown active">
        <a href="javascript:void(0)" class="dropbtn active">PvP IVs</a>
        <div class="dropdown-content">
          <a href="/">Rankings</a>
          <a href="/searchStr.html" class="active">Search Strings</a>
          <a href="https://routinehub.co/shortcut/1721">iOS Shortcut</a>
        </div>
      </li>
      <li class="dropdown">
        <a href="javascript:void(0)" class="dropbtn">Typing</a>
        <div class="dropdown-content">
          <a href="/typeLookup.html">Chart</a>
          <a href="/typeQuiz.html">Quiz</a>
        </div>
      </li>
      <li class="header" style="float:right"><a href="/about.html">About</a></li>
    </ul>
  </header>
  <section>
    <br />
    <input id="pokeList" placeholder="Final Mon"/>
    <label>
    	Top # Ranks:
    	<input type="number" value="10" id="limit" min="1" max="4096" oninput="start()">
    </label>
    <br />
    <label>Leauge:<select id="league" oninput="start()">
      <option value="1500">Great League</option>
	  	<option value="2500">Ultra League</option>
  		<option value="5000">Master League</option></select>
  	</label>
    <label>Trash String:<input id="trash" type="checkbox" oninput="start()"></label>
    <br /><br />
      <textarea id="output" rows="10" style="width: 100%; height: 50%;" onclick="autocopy(this)"></textarea>
      <div id="outputSummaryBox"></div>
      <div id="feedbackBox"></div>
      <!-- Footer Code Below -->
    <script src="https://shortcutIV.com/includes/escapedFooter.js"></script>
    <script src="https://shortcutIV.com/includes/sortingHat.js"></script>
    <script src="https://shortcutIV.com/includes/awesomplete.min.js"></script>
    <script src="https://shortcutIV.com/includes/pokeList.js"></script>
<script>
  
  // define Awesomeplete list https://leaverou.github.io/awesomplete/
  var input = document.getElementById("pokeList");
  var selected = undefined;
  
  var awesomplete = new Awesomplete(input, {list: pokeList,
  	// insert label instead of value into the input.
  	replace: function(suggestion) {
  		this.input.value = suggestion.label;
  		selected = suggestion.label;
  		start()
  	}
  });
  // end Awesomeplete definitions https://leaverou.github.io/awesomplete/
  
  var cpm = [0.094, 0.1351374318, 0.16639787, 0.192650919, 0.21573247, 0.2365726613, 0.25572005, 0.2735303812, 0.29024988, 0.3060573775, 0.3210876, 0.3354450362, 0.34921268, 0.3624577511, 0.3752356, 0.387592416, 0.39956728, 0.4111935514, 0.4225, 0.4329264091, 0.44310755, 0.4530599591, 0.4627984, 0.472336093, 0.48168495, 0.4908558003, 0.49985844, 0.508701765, 0.51739395, 0.5259425113, 0.5343543, 0.5426357375, 0.5507927, 0.5588305862, 0.5667545, 0.5745691333, 0.5822789, 0.5898879072, 0.5974, 0.6048236651, 0.6121573, 0.6194041216, 0.6265671, 0.6336491432, 0.64065295, 0.6475809666, 0.65443563, 0.6612192524, 0.667934, 0.6745818959, 0.6811649, 0.6876849038, 0.69414365, 0.70054287, 0.7068842, 0.7131691091, 0.7193991, 0.7255756136, 0.7317, 0.7347410093, 0.7377695, 0.7407855938, 0.74378943, 0.7467812109, 0.74976104, 0.7527290867, 0.7556855, 0.7586303683, 0.76156384, 0.7644860647, 0.76739717, 0.7702972656, 0.7731865, 0.7760649616, 0.77893275, 0.7817900548, 0.784637, 0.7874736075, 0.7903];

  function checkURI() {
    var URL = window.location.href.split("?")[1];
    //URL = "mon=Gyarados&r=169&cp=2500&o=00000&l=ko";
    if (URL)
    {
      URL = decodeURI(URL);
      //console.log("Read URL as: "+URL);
      var values = URL.split("&");
      //console.log("Values array as: "+JSON.stringify(values));
      for (var i=0; i<values.length; i++)
      {
        switch (values[i].split("=")[0]) {
          case "mon":
            selected = values[i].split("=")[1];
            awesomplete.input.value = selected
            break;
          case "r":
            document.getElementById('limit').value = values[i].split("=")[1];
            break;
          case "cp":
            document.getElementById('league').value = values[i].split("=")[1];
            break;
          case "o":
            var options = (''+values[i].split("=")[1]);
            
            if (options[0] == 1) { document.getElementById('trash').checked = true;
            } else { document.getElementById('trash').checked = false; }
            
            if (options[1] == 1) { document.getElementById('hundo').checked = true;
            } else { document.getElementById('hundo').checked = false; }
            
            if (options[2] == 1) { document.getElementById('hptrash').checked = true;
            } else { document.getElementById('hptrash').checked = false; }
            
            if (options[3] == 1) { document.getElementById('base').checked = true;
            } else { document.getElementById('base').checked = false; }
            
            if (options[4] == 1) { document.getElementById('baby').checked = true;
            } else { document.getElementById('baby').checked = false; }
            break;
          case "l":
            var lang = document.getElementById('lang');
            var languages = lang.options.length;
            for (var j=0; j<languages; j++) {
              if (lang.options[j].value.split(",")[0] == values[i].split("=")[1]) {
                lang.options[j].selected = true;
                break;
              }
            }
            break;
        }
      }
      start();
      return true;
    }
    else
    {
      console.log("No inputs detected, awaiting user input");
      return false;
    }
  }
  function start() {
    
    // exit if we haven't selected a mon yet
    if ((awesomplete.suggestions === undefined) && (selected === undefined)) {
      console.log("No pokemon found by start(), received:'"+awesomplete.suggestions+"' and '"+selected+"'");
      return;
    } else {
      if (selected === undefined) {
        console.log("Invalid input detected:'"+awesomplete.suggestions+"' and '"+selected+"'");
        return;
      } else {
        console.log("start: Found mon in both:'"+awesomplete.suggestions+"' and '"+selected+"'");
      }
    }
    
    var mon = '';
    // need to ensure we have the right mon selected
    if (awesomplete.suggestions !== undefined) {
      for (var i=0; i<awesomplete.suggestions.length; i++)
      {
        if (selected == awesomplete.suggestions[i].label)
        {
          //console.log("mon set to selected == awesomplete.suggestions["+i+"].label:"+awesomplete.suggestions[i].label)
          mon = awesomplete.suggestions[i].value;
        }
      }
    } else {
      // need to ensure we have the right mon selected
      var listLen = awesomplete.options.list.length;
      for (var i=0; i<listLen; i++)
      {
        if (selected == awesomplete.options.list[i].label)
        {
          //console.log("mon set to selected == awesomplete.suggestions["+i+"].label:"+awesomplete.suggestions[i].label)
          mon = awesomplete.options.list[i].value;
        }
      }
    }

    var value = mon.split(',');
    //console.log("value set to:"+JSON.stringify(value));
    var output = document.getElementById('output');
    //console.log("start(): 'mon' received as:"+JSON.stringify(mon));
    var base = document.getElementById('base').checked;
    
    // ignore base for Hitmons
    if ((base) && (!(['106', '107', '237'].includes(value[0]))))  {
      //console.log("Finding base evo, (['106', '107', '237'].includes(value):"+(['106', '107', '237'].includes(value[0])))
      var baseID = 10000;
      base = value[0];
      baseID = value[0].split("&")[0];
      //console.log("Using base of:"+base);
      //console.log("Using baseID of:"+baseID);
      
      for (var i=4; i<value.length; i++)
      {
        if (value[i].indexOf("&") > 0) {
          //console.log("Found an '&' in an evolved form ("+value[i]+")!");
          
          // skip baby forms unless checked (baby=true)
          if ((value[i].split("&")[1] === "eggsonly") && (!baby)) continue;
          if (baseID > value[i].split("&")[0]) {
            base = value[i];
            baseID = value[i].split("&")[0]
          }
        }
        // find base evolution
        if (baseID/1 > value[i]/1) {
          base = value[i];
          baseID = value[i];
          //console.log("Updated base evo to "+base);
        }
      }
      //console.log("Found base evo to be "+base);
    } else {
      // if we aren't using base evo, use the select mon's ID
      console.log("Skipping finding base evo, (['106', '107', '237'].includes(value):"+(['106', '107', '237'].includes(value[0])))
      base = value[0];
    }
    
    var baby = document.getElementById('baby').checked;
    if (baby)
    {
      baby = value[0];
      for (var i=4; i<value.length; i++)
      {
        if (value[i].indexOf("&") > 0) {
          if (value[i].split("&")[1] === "eggsonly") {
            //console.log("Found baby form! "+value[i]);
            base = value[i];
            break;
          }
        }
      }
      //console.log("Overwrote base evo with baby form:"+base);
    }
    
    // get base stats of whatever form we are outputting string for
    var baseatk, basedef, basesta, basemon = 0;
    
    //console.log("Can we print awesomeplete's list?"+JSON.stringify(awesomplete.suggestions));
    
    // found boolean fixes same dexNum forms displaying incorrectly (Rotom)
    found = false;
    for (i = 0; i < awesomplete.options.list.length; i++) {
      awesomplete.options.list[i].value.split(',')[0];
      if (base === awesomplete.options.list[i].value.split(',')[0]) {
        //console.log("Found base("+base+") at i:("+i+")");
        if (found) {
          if (selected !== awesomplete.options.list[i].label) {
            //console.log("No match: selected("+selected+") != "+awesomplete.options.list[i].label+" at i:("+i+")");
            continue;
          }
        }
        basemon = awesomplete.options.list[i].label;
        baseatk = awesomplete.options.list[i].value.split(',')[1];
        basedef = awesomplete.options.list[i].value.split(',')[2];
        basesta = awesomplete.options.list[i].value.split(',')[3];
        found = true;
      }
    }

    var league = document.getElementById('league').value;
    var limit = document.getElementById('limit').value;
    var trash = document.getElementById('trash').checked;
    var hundo = document.getElementById('hundo').checked;
    var hptrash = document.getElementById('hptrash').checked;
    var lang = document.getElementById('lang').value.split(',');
    var cpstr = lang[1], hpstr = lang[2];
    
    // validate reCaptcha v3
    // code reference: https://www.simoahava.com/analytics/improve-google-analytics-bot-detection-with-recaptcha/
    grecaptcha.ready(function() {
      grecaptcha.execute('6LfY-KYUAAAAAIYnP89WU5GWU-MMg_uy0z_7t9c2', {action: 'searchStr'}).then(function(token) {
        
        //Make xhr POST request to validate reCAPTCHA v3
        console.log("Validating reCAPTCHA...");
        var xhr = new XMLHttpRequest();
        xhr.onload = function() {
          if ((xhr.response !== 'noChange') && (xhr.response === 'Success')) {
            console.log("Success!");
          } else if (xhr.response === 'Error') {
            output.value = "ERROR";
            console.log("Error! xhr.status:"+xhr.status+" xhr.responseText:"+JSON.stringify(xhr.responseText));
            return false;
          } else {
            console.log("Unknown Response! xhr.status:"+xhr.status+" xhr.responseText:"+JSON.stringify(xhr.responseText));
          }
        };
        xhr.open('POST', 'https://us-central1-sandbox-of-alex-gronbach-2.cloudfunctions.net/validateReCaptchaV3', true);
        xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
        //xhr.send('token=ERROR');
        xhr.send('token=' + token + '&bqInsert=' + false + '&request=' + null);
      });
    });
    
    // prepare the output for the user!
    outputStr(calculate(parseInt(value[1]), parseInt(value[2]), parseInt(value[3]), league, 0, 0), base, basemon, baseatk, basedef, basesta, limit, trash, hundo, hptrash, league, output, lang[1], lang[2]);
    
    // build binary encoding of settings
    var binary = "";
    if (trash) { binary = "1";} else { binary = "0";}
    if (hundo) { binary += "1";} else { binary += "0";}
    if (hptrash) { binary += "1";} else { binary += "0";}
    if (document.getElementById('base').checked) { binary += "1";} else { binary += "0";}
    if (document.getElementById('baby').checked) { binary += "1";} else { binary += "0";}
    //console.log("Binary:"+binary);
    
    // update the URL with search parameters
    var uri = window.location.href.split("?")[0];
    uri = encodeURI(uri + "?mon="+selected+"&r="+limit+"&cp="+league+"&o="+binary+"&l="+document.getElementById('lang').value.split(',')[0]);
    //console.log("URI:"+uri);
    var newTitle = "ShortcutIV - PvP Search Strings - " + "Rank " + limit + " " + selected + " ("+league+")";
    window.history.pushState(null, newTitle, uri);

    return true;
  }
  
  function outputStr(ranks, id, mon, baseatk, basedef, basesta, limit, trash, hundo, hptrash, league, output, cpstr, hpstr) {
    //console.log("outputStr (except ranks, output): id:"+id+", mon:"+mon+", baseatk:"+baseatk+", basedef:"+basedef+", basesta:"+basesta+", limit:"+limit+", trash:"+trash+", hundo:"+hundo+", league:"+league+", cpstr:"+cpstr+", hpstr:"+hpstr);
    //console.log("outputStr ranks="+JSON.stringify(ranks));
    
    var rKeys = Object.keys(ranks);
    var rLength = rKeys.length - 3; // skip max stat entries
    var totalRanks = rLength;
    var singleStar = true;
    var dualStar = true;
    var triStar = true;
    var firstStarVal = ranks[rKeys[0]][0].IVs.star;
    var secondStarVal = undefined;
    var thirdStarVal = undefined;
    var no0star = true;
    var no1star = true;
    var no2star = true;
    var no3star = true;
    var no4star = true;
    var no5star = true;
    
    // set first ranking's noXstar value before entering the loop below
    if ((no0star) && (ranks[rKeys[0]][0].IVs.star === "0*")) { no0star = false; }
    else { if ((no1star) && (ranks[rKeys[0]][0].IVs.star === "1*")) {no1star=false;}
    else { if ((no2star) && (ranks[rKeys[0]][0].IVs.star === "2*")) {no2star=false;}
    else { if ((no3star) && (ranks[rKeys[0]][0].IVs.star === "3*")) {no3star=false;}
    else { if ((no4star) && (ranks[rKeys[0]][0].IVs.star === "4*")) {no4star=false;}
    }}}}

    // see if we can output only one appraisal star in string (if all match)
    for (var i=1; ((i<rLength) && (i<limit)); i++) {
      for (var j=0; j<ranks[rKeys[i]].length; j++) {
        if (j>0) {
          //console.log("Found hash collision row at "+rKeys[i]+"! "+JSON.stringify(ranks[rKeys[i]], null, 2));
          totalRanks = totalRanks + 1;
        }
      
        // track which star appraisal values are present within limit
        if ((no0star) && (ranks[rKeys[i]][j].IVs.star === "0*")) { no0star = false; }
          else { if ((no1star) && (ranks[rKeys[i]][j].IVs.star === "1*")) {no1star=false;}
          else { if ((no2star) && (ranks[rKeys[i]][j].IVs.star === "2*")) {no2star=false;}
          else { if ((no3star) && (ranks[rKeys[i]][j].IVs.star === "3*")) {no3star=false;}
          else { if ((no4star) && (ranks[rKeys[i]][j].IVs.star === "4*")) {no4star=false;}
        }}}}
        
        if (firstStarVal == ranks[rKeys[i]][j].IVs.star) { continue; } else {
          if (secondStarVal === undefined) {
            // store first mismatch position in singleStar, init secondStarVal
            singleStar = i;
            secondStarVal = ranks[rKeys[i]][j].IVs.star;
            
            // knowing that ranks[rKeys[i]][j].IVs.star != firstStarVal, check if == secondStarVal
            } else {
              if (secondStarVal == ranks[rKeys[i]][j].IVs.star) { continue; } else {
                if (thirdStarVal === undefined) {
                  // store first mismatch position in dualStar, init thirdStarVal
                  dualStar = i;
                  thirdStarVal = ranks[rKeys[i]][j].IVs.star;
                  
                // knowing that ranks[rKeys[i]][j].IVs.star != firstStarVal and != secondStarVal, check if == thirdStarVal
                } else {
                  if (thirdStarVal == ranks[rKeys[i]][j].IVs.star) { continue; } else {
                    // store first mismatch position in triStar
                    if (triStar === true) {
                      //console.log("Found first mismatch / 4th star at: ranks[rKeys["+i+"]].IVs.star:" +ranks[rKeys[i]][j].IVs.star);
                      triStar = i; }
                  }
                }
              }
            }
        }
      }
    }
    
    //console.log("Set values no0star:"+no0star+" no1star:"+no1star+" no2star:"+no2star+" no3star:"+no3star+" no4star:"+no4star);

    // let the user know to adjust their query
    if (!trash)
    {
      var message = '';
      if (triStar !== true) {
        // there are four different appraisals within limit
        message = "Top "+triStar+ " ranks are all "+thirdStarVal+", "+secondStarVal+", "+firstStarVal+", appraisals";
        document.getElementById('feedbackBox').innerHTML = "<p><i>"+message+"</i></p>";
      } else {
        // there are three different appraisals within limit
        if (dualStar !== true) {
        message = "Top "+dualStar+ " ranks are all "+secondStarVal+", "+firstStarVal+", appraisals";
        document.getElementById('feedbackBox').innerHTML = "<p><i>"+message+"</i></p>";
        } else {
          // there are two different appraisals within limit
          if (singleStar !== true) {
            message = "Top "+singleStar+ " ranks are all "+firstStarVal+" appraisals";
            document.getElementById('feedbackBox').innerHTML = "<p><i>"+message+"</i></p>";
            } else {
              // there are more than four different appraisals within limit
              document.getElementById('feedbackBox').innerHTML = "";
            }
        }
      }
    } else {
    // clear for trash string output
    document.getElementById('feedbackBox').innerHTML = "";
    }
    
    var cps = new Set(), hps = new Set();
    var maxCP = 0, maxHP = 0;

    // generate all the cps and hps for matching
    // for ranks 1 to user limit, up to maxLvl (L) for league
    for (var i=0; ((i<rLength) && (i<limit)); i++) {
      for (var j=0; j<ranks[rKeys[i]].length; j++) {
      
        // start at maxLvl (up to league limit)
        var maxLvl = (ranks[rKeys[i]][j].L - 1)*2;
        // see if this is a half-level (these don't spawn in the wild)
        if (maxLvl%2 != 0)
        {
          // ensure we build search string only on "full" levels
          maxLvl = maxLvl - 1; // set to non-half level
        }
  
        // skip half level CPs in search strings to improve accuracy
        for( var level = maxLvl; level >= 0; level = level - 2 ) {
          var cp = Math.max(10, Math.floor((baseatk/1 + ranks[rKeys[i]][j].IVs.A) * Math.sqrt(basedef/1 + ranks[rKeys[i]][j].IVs.D) * Math.sqrt(basesta/1 + ranks[rKeys[i]][j].IVs.S) * cpm[level] * cpm[level] / 10));
  
          // generate hps for more accurate search string matching
          var hp = Math.max(10, Math.floor((basesta/1 + ranks[rKeys[i]][j].IVs.S) * cpm[level]));
          
  
          // update counters for maxCP0 and maxHP0
          if (maxCP < cp) {maxCP = cp};
          if (maxHP < hp) {maxHP = hp};
          cps.add(cp);
          hps.add(hp);
        }
      }
    }

    // if we are trashing but skipping hundos
    if ((trash) && (!hundo)) {
      output.value = '!4*&';
    } else {
      // ensure old output is cleared!
      output.value = '';
    }
    
    // output the CPs and HPs
    outputCPsHPs(firstStarVal, singleStar, cps, maxCP, hps, maxHP, output, id, cpstr, hpstr, trash, hptrash);
    
    if ((!trash) && (singleStar !== true)) {
      // help narrow down search accuracy
      if (no0star) { output.value += '&!0*'; }
      if (no1star) { output.value += '&!1*'; }
      if (no2star) { output.value += '&!2*'; }
      if (no3star) { output.value += '&!3*'; }
      if (no4star) { output.value += '&!4*'; }
    }
    
    // let the user know what we just output
    var message = "";
    var printLimit = Math.min(limit, totalRanks);
    if (trash) {
      if (hundo) {
        message = "String trashes all "+mon+" except Top "+printLimit+ " PvP "+selected;
      } else {
        message = "String trashes all "+mon+" except perfect IV (15/15/15) and Top "+printLimit+ " PvP "+selected;
      }
    } else {
      message = "String finds Top "+printLimit+ " "+mon+", for PvP "+selected;
    }
    //console.log(message);
    document.getElementById('outputSummaryBox').innerHTML = "<p>"+message+"</p>";
    
    return output;
  }
  
  function outputCPsHPs(starVal, singleStar, cps, maxCP, hps, maxHP, output, id, cpstr, hpstr, trash, hptrash) {
    //console.log("Flipping cps and hps with maxCP("+maxCP+") and maxHP("+maxHP+")");
    
    if (trash) {
      
      // flip CPs and HPs for trashing
      for (var i=10; i<=maxCP; i++) {
        if( cps.has(i) ) {
  				cps.delete(i);
  			} else {
  				cps.add(i);
  		  }
      }
      
      for (var i=10; i<=maxHP; i++) {
        if( hps.has(i) ) {
  				hps.delete(i);
  			} else {
  				hps.add(i);
  		  }
      }
      
      // output CPs and HPs
      cps = Array.from(cps);
      cps.sort((a, b) => a - b);
      //console.log("cps after invert:"+JSON.stringify(cps));
      output.value += id + '&' + get_matching_string(cps, cpstr);
      
      if (hptrash) {
        hps = Array.from(hps);
        hps.sort((a, b) => a - b);
        output.value += ',' + get_matching_string(hps, hpstr);
        //console.log("hps after invert:"+JSON.stringify(hps));
        }
    } else {
      // output CPs and HPs
      cps = Array.from(cps);
      cps.sort((a, b) => a - b);
      //console.log("cps after invert:"+JSON.stringify(cps));
      if (singleStar === true) {
        output.value += id + '&' + starVal + '&' + get_matching_string(cps, cpstr);
      } else {
        output.value += id + '&' + get_matching_string(cps, cpstr);
      }
      
      hps = Array.from(hps);
      hps.sort((a, b) => a - b);
      output.value += '&' + get_matching_string(hps, hpstr);
      //console.log("hps generated:"+JSON.stringify(hps));
    }
    return true;
  }
  
  function get_matching_string(a, t) {
    var list = '', last = -1;
  	for( var i = 0; i < a.length; i++ ) {
  		if( a[i] == last + 1 ) {
  			list += '-';
  			last = a[i];
  			while( ++i < a.length ) {
  				if( a[i] != last + 1 ) break;
  				last = a[i];
  			}
  			if( a[--i] < 9999 ) {
  				list += a[i];
  			}
  		} else {
  			list += ',' + t + a[i];
  			last = a[i];
  		}
  	}

  	return list.substr(1);
  }
  
  function autocopy(e) {
  	e.select();
  	document.execCommand('copy');
  }
  </script>
    <h3>Settings:</h3>
    <label>
    	Trash Perfect IVs:
    	<input id="hundo" type="checkbox" checked oninput="start()">
    </label><br />
    <label>
    	Include HPs in Trash String:
    	<input id="hptrash" type="checkbox" checked oninput="start()">
    </label><br />
    <label>
    	Use Base Evolution:
    	<input id="base" type="checkbox" checked oninput="start()">
    </label><br />
    <label>
    	Use Baby Form:
    	<input id="baby" type="checkbox" oninput="start()">
    </label><br />
    <label>
    	Language:
    	<select id="lang" oninput="start()">
    		<option value="en,cp,hp">English</option>
    		<option value="ja,cp,hp">Japanese</option>
    		<option value="fr,pc,pv">French</option>
    		<option value="es,pc,puntos de salud">Spanish</option>
    		<option value="de,wp,kp">German</option>
    		<option value="il,pl,punti salute">Italian</option>
    		<option value="ko,cp,hp">Korean</option>
    		<option value="zh,cp,hp">Chinese</option>
    		<option value="pt,pc,ps">Portuguese</option>
    	</select>
    </label>
    <div style="overflow-x:auto;"><br />
      <p style="color:silver;font-size:0.6em">This site is protected by reCAPTCHA and the Google
      <a style="color:#AED6F1" href="https://policies.google.com/privacy">Privacy Policy</a> and
      <a style="color:#AED6F1" href="https://policies.google.com/terms">Terms of Service</a> apply.</p>
    </div>
    </section>
  </body>
</html>